<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="sl-pig.html">
<link rel="import" href="sl-organ.html">
<link rel="import" href="melon.html">

<dom-module id="pig-view">
  <template>
    <style include="melon"></style>
    <style>
      :host {
        display: block;
        padding: 10px;
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
      }

      :host .card {
        margin: 5px;
      }

      #pig {
        min-width: 500px;
        @apply(--layout-flex-7);
      }

      #cart {
        min-width: 400px;
        @apply(--layout-flex-5);
        padding: 10px;
      }

      .listItem sl-organ /deep/ svg {
        height: 50px;
      }
    </style>
    <div id="pig">
      <sl-pig id=[[pigid]] pig="{{pig}}" interactive></sl-pig>
    </div>
    <paper-card id="cart">
      <template is="dom-if" if="true">
        <h2>Cart</h2>
        <template is="dom-repeat" items="[[cartList.items]]">
          <div class="listItem">
            <sl-organ type="[[item.type]]" color="[[item.color]]"></sl-organ>
          </div>
        </template>
        <template is="dom-if" if="[[cartList.moreItems]]">
          <div class="">
            There are more items in your cart ([[cartList.moreItemsCount]]).
          </div>
        </template>
      </template>
    </paper-card>
  </template>

  <script>
    Polymer({
      is: 'pig-view',
      properties: {
        pig: {
          type: Object,
          value: {},
          notify: false,
        },
        pigid: {
          type: String,
        },
        cart: {
          type: Object,
          value: {},
        },
        active: {
          type: Boolean,
          value: false,
          notify: true
        },
        cartList: {
          type: Object,
          computed: '_computeCartList(cart.*, pigid)'
        }
      },

      _computeCartList: function () {
        var cartList = {moreItems: false, moreItemsCount: 0, items: []};
        for(var pigid in this.cart) {
          for(var organName in this.cart[pigid]) {
            if(pigid == this.pigid) {
              cartList.items.push({type: organName, color: this.cart[pigid][organName]})
            } else {
              cartList.moreItems = true
              cartList.moreItemsCount++
            }
          }
        }
        return cartList
      },
    });
  </script>
</dom-module>
